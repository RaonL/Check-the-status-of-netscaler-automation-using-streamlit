#ìŠ¤íŠ¸ë¦¼ë¦¿ì„ ì‚¬ìš©í•œ Citrix ADC ìƒíƒœëª¨ë‹ˆí„°ë§ ë³´ê³ ì„œ
import requests
import json
import streamlit as st
import pandas as pd
from credential import *

requests.packages.urllib3.disable_warnings()

USERNAME = ""
PASSWORD = ""

devices = [
    {"name": "ns", "ip": ""},
    {"name": "ns", "ip": ""},

]

cred_headers = {
    'X-NITRO-USER': USERNAME,
    'X-NITRO-PASS': PASSWORD
}


def get_stats(of_item, ip) -> dict:
    url = f"https://{ip}/nitro/v1/stat/{of_item}"
    response = requests.request("GET", url, headers=cred_headers, verify=False)
    response_dict = json.loads(response.text)
    return response_dict


def main():
    st.set_page_config(
        page_title="Citrix ADC Status Dashboard",
        page_icon="ğŸ“Š"

    )

    st.title("Netscaler ìƒíƒœ ì ê²€ì„œ")

    metrics = ["mgmtcpuusagepcnt", "pktcpuusagepcnt", "memusagepcnt", "rxmbitsrate", "txmbitsrate",
               "httprequestsrate", "httpresponsesrate", "httprxrequestbytesrate", "httprxresponsebytesrate",
               "tcpcurclientconn", "tcpcurserverconn", "tcpcurclientconnestablished", "tcpcurserverconnestablished",
               "ssltransactionsrate", "sslsessionhitsrate", "cachehitsrate", "cachetothits", "disk0perusage",
               "disk1perusage", "powersupply1status", "powersupply2status", "cpufan0speed", "systemfanspeed",
               "cpu0temp", "internaltemp"]

    for device in devices:
        ip = device["ip"]
        ns_stats = get_stats("ns", ip)
        system_stats = get_stats("system", ip)

        data = {
            "ì ê²€ë‚´ìš©": [],
            "ê²°ê³¼": []
        }

        for metric in metrics:
            if metric in ns_stats['ns'] or metric in system_stats['system']:
                value = ns_stats['ns'].get(metric, system_stats['system'].get(metric, None))
                if value is not None:
                    data["ì ê²€ë‚´ìš©"].append(metric)
                    data["ê²°ê³¼"].append(str(value))  # Convert all values to strings

        df = pd.DataFrame(data)

        st.subheader(f"{device['name']} - {device['ip']}")
        st.table(df)


if __name__ == "__main__":
    main()
